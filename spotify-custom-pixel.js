// page view
analytics.subscribe("page_viewed", (event) => {
    (function (w, d) {
        var id = 'spdt-capture', n = 'script';
        if (!d.getElementById(id)) {
            w.spdt =
                w.spdt ||
                function () {
                    (w.spdt.q = w.spdt.q || []).push(arguments);
                };
            var e = d.createElement(n);
            e.id = id;
            e.async = 1;
            e.src = 'https://pixel.byspotify.com/ping.min.js';
            var s = d.getElementsByTagName(n)[0];
            s.parentNode.insertBefore(e, s);
        }
        w.spdt('conf', {key: 'XXXXXXXXXXXXXXXXXXXXXXXX'});
        w.spdt('view');
    })(window, document);
});

// add to cart
analytics.subscribe("product_added_to_cart", (event) => {
    // Installation script generated by Ad Analytics
    (function (w, d) {
        var id = 'spdt-capture', n = 'script';
        if (!d.getElementById(id)) {
            w.spdt =
                w.spdt ||
                function () {
                    (w.spdt.q = w.spdt.q || []).push(arguments);
                };
            var e = d.createElement(n);
            e.id = id;
            e.async = 1;
            e.src = 'https://pixel.byspotify.com/ping.min.js';
            var s = d.getElementsByTagName(n)[0];
            s.parentNode.insertBefore(e, s);
        }
        w.spdt('conf', {key: 'XXXXXXXXXXXXXXXXXXXXXXXX'});
        w.spdt('addtocart', {
            value: event.data.cartLine.cost.totalAmount.amount,
            currency: event.data.cartLine.cost.totalAmount.currencyCode,
            quantity: event.data.cartLine.quantity,
            product_id: event.data.cartLine.merchandise.product.id,
            product_name: event.data.cartLine.merchandise.product.title,
            product_type: event.data.cartLine.merchandise.product.type,
            product_vendor: 'Everyday Dose',
            variant_id: event.data.cartLine.merchandise.id,
            variant_name: event.data.cartLine.merchandise.title
        });
    })(window, document);
});


// purchase
analytics.subscribe("checkout_completed", (event) => {
    // Installation script generated by Ad Analytics
    (function (w, d) {
        var id = 'spdt-capture', n = 'script';
        if (!d.getElementById(id)) {
            w.spdt =
                w.spdt ||
                function () {
                    (w.spdt.q = w.spdt.q || []).push(arguments);
                };
            var e = d.createElement(n);
            e.id = id;
            e.async = 1;
            e.src = 'https://pixel.byspotify.com/ping.min.js';
            var s = d.getElementsByTagName(n)[0];
            s.parentNode.insertBefore(e, s);
        }
        w.spdt('conf', {key: 'XXXXXXXXXXXXXXXXXXXXXXXX'});
        w.spdt('purchase', {
            order_id: event.data.checkout.order.id,
            discount_code: event.data.checkout.discountApplications.map(discount => discount.title).join(","),
            value: event.data.checkout.totalPrice.amount,
            currency: event.data.checkout.currencyCode
        });
    })(window, document);
});